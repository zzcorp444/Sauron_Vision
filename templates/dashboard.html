<!-- templates/dashboard.html -->
{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-left">
            <img src="{% static 'images/sv_logo_00.png' %}" alt="SV" class="header-logo">
            <h1>SAURON VISION</h1>
        </div>
        <div class="header-center">
            <div class="market-status">
                <span class="status-indicator active"></span>
                <span>MARKET {{ market_status }}</span>
                
                <!-- Market Status Popup -->
                <div class="market-status-popup">
                    <div class="market-group">
                        <h4><i class="fas fa-circle" style="color: var(--primary-text);"></i> Open Markets</h4>
                        <div class="market-list">
                            <div class="market-item open">
                                <span class="market-name">NYSE</span>
                                <span class="market-time">9:30 AM - 4:00 PM EST</span>
                            </div>
                            <div class="market-item open">
                                <span class="market-name">NASDAQ</span>
                                <span class="market-time">9:30 AM - 4:00 PM EST</span>
                            </div>
                            <div class="market-item open">
                                <span class="market-name">London Stock Exchange</span>
                                <span class="market-time">8:00 AM - 4:30 PM GMT</span>
                            </div>
                            <div class="market-item open">
                                <span class="market-name">Crypto (24/7)</span>
                                <span class="market-time">Always Open</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="market-group">
                        <h4><i class="fas fa-circle" style="color: var(--error-text);"></i> Closed Markets</h4>
                        <div class="market-list">
                            <div class="market-item closed">
                                <span class="market-name">Tokyo Stock Exchange</span>
                                <span class="market-time">9:00 AM - 3:00 PM JST</span>
                            </div>
                            <div class="market-item closed">
                                <span class="market-name">Shanghai Exchange</span>
                                <span class="market-time">9:30 AM - 3:00 PM CST</span>
                            </div>
                            <div class="market-item closed">
                                <span class="market-name">Hong Kong Exchange</span>
                                <span class="market-time">9:30 AM - 4:00 PM HKT</span>
                            </div>
                            <div class="market-item closed">
                                <span class="market-name">Sydney Exchange</span>
                                <span class="market-time">10:00 AM - 4:00 PM AEDT</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-right">
            <div class="user-info">
                <span>{{ user.user_id }}</span>
                <div class="icon-group">
                    <div class="icon-wrapper" id="notifications-icon">
                        <i class="fas fa-bell"></i>
                        <span class="icon-count" style="display: none;">0</span>
                        <div class="icon-popup">
                            <div class="popup-header">
                                <span class="popup-title">Notifications</span>
                                <i class="fas fa-check-circle" style="color: var(--primary-text); cursor: pointer;" title="Mark all as read"></i>
                            </div>
                            <div class="popup-content">
                                <div class="popup-item">
                                    <div class="popup-item-header">
                                        <span class="popup-item-type">System</span>
                                        <span class="popup-item-time">2m ago</span>
                                    </div>
                                    <div class="popup-item-message">Strategy "Mean Reversion" completed backtest</div>
                                </div>
                                <div class="popup-item">
                                    <div class="popup-item-header">
                                        <span class="popup-item-type">Trade</span>
                                        <span class="popup-item-time">15m ago</span>
                                    </div>
                                    <div class="popup-item-message">Order filled: AAPL 100 shares @ $150.25</div>
                                </div>
                                <div class="popup-item">
                                    <div class="popup-item-header">
                                        <span class="popup-item-type">Alert</span>
                                        <span class="popup-item-time">1h ago</span>
                                    </div>
                                    <div class="popup-item-message">Portfolio rebalancing recommended</div>
                                </div>
                            </div>
                            <div class="popup-footer">
                                <a href="/notifications" class="view-all-btn">View All Notifications</a>
                            </div>
                        </div>
                    </div>
                    <div class="icon-wrapper" id="activity-icon">
                        <i class="fas fa-chart-line"></i>
                        <span class="icon-count" style="display: none;">0</span>
                        <div class="icon-popup">
                            <div class="popup-header">
                                <span class="popup-title">Activity</span>
                                <i class="fas fa-filter" style="color: var(--primary-text); cursor: pointer;" title="Filter"></i>
                            </div>
                            <div class="popup-content">
                                <div class="popup-item">
                                    <div class="popup-item-header">
                                        <span class="popup-item-type">Trade Executed</span>
                                        <span class="popup-item-time">Just now</span>
                                    </div>
                                    <div class="popup-item-message">BUY TSLA 50 shares @ $850.75</div>
                                </div>
                                <div class="popup-item">
                                    <div class="popup-item-header">
                                        <span class="popup-item-type">Signal Generated</span>
                                        <span class="popup-item-time">5m ago</span>
                                    </div>
                                    <div class="popup-item-message">New buy signal for NVDA (Tier 4)</div>
                                </div>
                                <div class="popup-item">
                                    <div class="popup-item-header">
                                        <span class="popup-item-type">Strategy Active</span>
                                        <span class="popup-item-time">30m ago</span>
                                    </div>
                                    <div class="popup-item-message">Momentum strategy scanning markets</div>
                                </div>
                            </div>
                            <div class="popup-footer">
                                <a href="/activity" class="view-all-btn">View All Activity</a>
                            </div>
                        </div>
                    </div>
                    <div class="icon-wrapper" id="alerts-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span class="icon-count" style="display: none;">0</span>
                        <div class="icon-popup">
                            <div class="popup-header">
                                <span class="popup-title">Alerts</span>
                                <i class="fas fa-cog" style="color: var(--primary-text); cursor: pointer;" title="Settings"></i>
                            </div>
                            <div class="popup-content">
                                <div class="popup-item">
                                    <div class="popup-item-header">
                                        <span class="popup-item-type" style="color: var(--error-text);">Critical</span>
                                        <span class="popup-item-time">Now</span>
                                    </div>
                                    <div class="popup-item-message">Portfolio risk exceeded threshold</div>
                                </div>
                                <div class="popup-item">
                                    <div class="popup-item-header">
                                        <span class="popup-item-type" style="color: var(--warning-text);">Warning</span>
                                        <span class="popup-item-time">10m ago</span>
                                    </div>
                                    <div class="popup-item-message">TSLA approaching stop loss level</div>
                                </div>
                                <div class="popup-item">
                                    <div class="popup-item-header">
                                        <span class="popup-item-type">Info</span>
                                        <span class="popup-item-time">2h ago</span>
                                    </div>
                                    <div class="popup-item-message">Market volatility increasing</div>
                                </div>
                            </div>
                            <div class="popup-footer">
                                <a href="/alerts" class="view-all-btn">View All Alerts</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <a href="{% url 'logout' %}" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
            </a>
        </div>
    </header>

    <!-- Status Ticker Bar -->
    <div class="status-ticker-bar">
        <div class="status-ticker-content">
            <div class="status-item" data-id="1">
                <i class="fas fa-cog"></i>
                <span class="status-item-title">System Status:</span>
                <span class="status-item-detail">All strategies running smoothly</span>
            </div>
            <div class="status-item" data-id="2">
                <i class="fas fa-brain"></i>
                <span class="status-item-title">AI Analysis:</span>
                <span class="status-item-detail">Processing 1,247 market signals</span>
            </div>
            <div class="status-item" data-id="3">
                <i class="fas fa-newspaper"></i>
                <span class="status-item-title">Breaking:</span>
                <span class="status-item-detail">Fed announces rate decision in 2 hours</span>
            </div>
            <div class="status-item" data-id="4">
                <i class="fas fa-rocket"></i>
                <span class="status-item-title">Hot Signal:</span>
                <span class="status-item-detail">NVDA showing strong breakout pattern</span>
            </div>
            <div class="status-item" data-id="5">
                <i class="fas fa-shield-alt"></i>
                <span class="status-item-title">Risk Alert:</span>
                <span class="status-item-detail">Portfolio VaR approaching threshold</span>
            </div>
            <div class="status-item" data-id="6">
                <i class="fas fa-globe"></i>
                <span class="status-item-title">Global Event:</span>
                <span class="status-item-detail">Asian markets closing in 30 minutes</span>
            </div>
        </div>
    </div>

    <!-- Connection Status -->
    <div class="connection-status">
        <div>
            <span class="status-dot"></span>
            <span>Sauron Vision: Connected - Logged In</span>
        </div>
        <div class="time-display" id="local-time"></div>
        <div class="ping-display">Ping: <span id="ping-value">12</span>ms</div>
    </div>

    <!-- Dashboard Layout -->
    <div class="dashboard-layout">
        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <button class="sidebar-toggle" id="sidebar-toggle">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <nav class="nav-menu">
                    <a href="#" class="nav-item active" data-section="overview">
                        <i class="fas fa-eye"></i>
                        <span>Overview</span>
                    </a>
                    <a href="#" class="nav-item" data-section="market-scanner">
                        <i class="fas fa-search"></i>
                        <span>Market Scanner</span>
                    </a>
                    <a href="{% url 'vision' %}" class="nav-item">
                        <i class="fas fa-cube"></i>
                        <span>Vision 3D</span>
                    </a>
                    <a href="#" class="nav-item" data-section="strategy-builder">
                        <i class="fas fa-cogs"></i>
                        <span>Strategy Builder</span>
                    </a>
                    <a href="#" class="nav-item" data-section="risk-monitor">
                        <i class="fas fa-shield-alt"></i>
                        <span>Risk Monitor</span>
                    </a>
                    <a href="#" class="nav-item" data-section="sentiment-analysis">
                        <i class="fas fa-brain"></i>
                        <span>Sentiment Analysis</span>
                    </a>
                    <a href="#" class="nav-item" data-section="terminal">
                        <i class="fas fa-terminal"></i>
                        <span>Terminal</span>
                    </a>
                </nav>
                
                <!-- News Intelligence Bar - Positioned after sidebar -->
                <div class="news-intelligence-bar" id="news-bar">
                    <div class="news-bar-header">
                        <div class="news-bar-title">
                            <i class="fas fa-newspaper"></i>
                            <span>Market Intelligence</span>
                        </div>
                        <div class="news-bar-controls">
                            <button class="news-filter-btn active" data-filter="all">All</button>
                            <button class="news-filter-btn" data-filter="news">News</button>
                            <button class="news-filter-btn" data-filter="social">Social</button>
                            <button class="news-filter-btn" data-filter="analysis">Analysis</button>
                            <button class="news-filter-btn" data-filter="alerts">Alerts</button>
                        </div>
                    </div>
                    
                    <div class="news-content">
                        <!-- News Items -->
                        <div class="news-item" data-type="news">
                            <div class="news-source">
                                <span class="news-source-name">Bloomberg</span>
                                <span class="news-time">2 min ago</span>
                            </div>
                            <h4 class="news-headline">Fed Signals Pause in Rate Hikes as Inflation Shows Signs of Cooling</h4>
                            <p class="news-summary">Federal Reserve officials indicated they may hold interest rates steady in the upcoming meeting...</p>
                            <div class="news-meta">
                                <div class="sentiment-indicator positive">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>Bullish</span>
                                </div>
                                <div class="social-metrics">
                                    <span class="social-metric"><i class="fab fa-twitter"></i> 1.2k</span>
                                    <span class="social-metric"><i class="fas fa-comments"></i> 342</span>
                                </div>
                            </div>
                            <div class="news-tags">
                                <span class="news-tag">Fed</span>
                                <span class="news-tag">Rates</span>
                                <span class="news-tag ticker">SPY</span>
                            </div>
                        </div>
                        
                        <div class="news-item" data-type="social">
                            <div class="news-source">
                                <span class="news-source-name">Reddit - WSB</span>
                                <span class="news-time">5 min ago</span>
                            </div>
                            <h4 class="news-headline">Unusual Options Activity Detected on NVDA</h4>
                            <p class="news-summary">Massive call option purchases for NVDA $500 strike...</p>
                            <div class="news-meta">
                                <div class="sentiment-indicator positive">
                                    <i class="fas fa-fire"></i>
                                    <span>Hot</span>
                                </div>
                                <div class="social-metrics">
                                    <span class="social-metric"><i class="fas fa-arrow-up"></i> 5.8k</span>
                                </div>
                            </div>
                            <div class="news-tags">
                                <span class="news-tag ticker">NVDA</span>
                                <span class="news-tag">Options</span>
                            </div>
                        </div>
                        
                        <div class="news-item" data-type="analysis">
                            <div class="news-source">
                                <span class="news-source-name">Sauron AI</span>
                                <span class="news-time">10 min ago</span>
                            </div>
                            <h4 class="news-headline">Pattern Alert: AAPL Ascending Triangle</h4>
                            <p class="news-summary">Bullish pattern formation with 85% success rate...</p>
                            <div class="news-meta">
                                <div class="sentiment-indicator positive">
                                    <i class="fas fa-chart-line"></i>
                                    <span>Buy Signal</span>
                                </div>
                            </div>
                            <div class="news-tags">
                                <span class="news-tag ticker">AAPL</span>
                                <span class="news-tag">Technical</span>
                            </div>
                        </div>
                        
                        <div class="news-item" data-type="news">
                            <div class="news-source">
                                <span class="news-source-name">Reuters</span>
                                <span class="news-time">15 min ago</span>
                            </div>
                            <h4 class="news-headline">Tesla Q4 Deliveries Beat Estimates</h4>
                            <p class="news-summary">484,507 vehicles delivered, beating expectations...</p>
                            <div class="news-meta">
                                <div class="sentiment-indicator positive">
                                    <i class="fas fa-rocket"></i>
                                    <span>Bullish</span>
                                </div>
                            </div>
                            <div class="news-tags">
                                <span class="news-tag ticker">TSLA</span>
                                <span class="news-tag">Earnings</span>
                            </div>
                        </div>
                        
                        <!-- More news items... -->
                    </div>
                </div>
            </aside>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Overview Section -->
                <section id="overview" class="content-section active">
                    <div class="section-header">
                        <h2>Market Overview</h2>
                        <div class="section-controls">
                            <button class="control-btn">
                                <i class="fas fa-refresh"></i>
                            </button>
                            <div class="bulk-actions">
                                <button class="control-btn" id="bulk-actions-btn">
                                    <i class="fas fa-th"></i> Bulk Actions
                                </button>
                                <div class="bulk-actions-menu">
                                    <div class="bulk-action-item" onclick="toggleAllCards('expand')">
                                        <i class="fas fa-expand"></i> Expand All Cards
                                    </div>
                                    <div class="bulk-action-item" onclick="toggleAllCards('collapse')">
                                        <i class="fas fa-compress"></i> Collapse All Cards
                                    </div>
                                    <div class="bulk-action-item" onclick="showCardManager()">
                                        <i class="fas fa-columns"></i> Manage Cards
                                    </div>
                                    <div class="bulk-action-item" onclick="resetLayout()">
                                        <i class="fas fa-undo"></i> Reset Layout
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="overview-grid">
                        <div class="overview-card" id="portfolio-card">
                            <h3>Portfolio</h3>
                            <div class="card-content">
                                <div class="portfolio-grid">
                                    <div class="metric">
                                        <span class="value">$125,847</span>
                                        <span class="label">Total Value</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value">$15,234</span>
                                        <span class="label">Available Cash</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value positive">+2.35%</span>
                                        <span class="label">Today's Change</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value positive">+$2,847</span>
                                        <span class="label">Today's P&L</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value">6</span>
                                        <span class="label">Active Positions</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value warning">Medium</span>
                                        <span class="label">Risk Level</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value">1.15</span>
                                        <span class="label">Portfolio Beta</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value positive">8.7</span>
                                        <span class="label">Portfolio Score</span>
                                    </div>
                                </div>
                                
                                <!-- Orders to Market Section -->
                                <div class="orders-section">
                                    <h4>Orders to Market</h4>
                                    <div class="order-list">
                                        <div class="order-item">
                                            <span class="order-type limit">LIMIT</span>
                                            <span>BUY NVDA @ $455.00</span>
                                            <span class="order-status">Pending</span>
                                        </div>
                                        <div class="order-item">
                                            <span class="order-type market">MARKET</span>
                                            <span>SELL META 50 shares</span>
                                            <span class="order-status">Queued</span>
                                        </div>
                                        <div class="order-item">
                                            <span class="order-type limit">LIMIT</span>
                                            <span>BUY SPY @ $430.00</span>
                                            <span class="order-status">Pending</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Portfolio Charts (shown when expanded) -->
                                <div class="portfolio-charts">
                                    <div class="chart-container">
                                        <div class="chart-title">Portfolio Performance</div>
                                        <canvas id="portfolio-performance-chart"></canvas>
                                    </div>
                                    <div class="chart-container">
                                        <div class="chart-title">Asset Allocation</div>
                                        <canvas id="asset-allocation-chart"></canvas>
                                    </div>
                                    <div class="chart-container">
                                        <div class="chart-title">Risk Distribution</div>
                                        <canvas id="risk-distribution-chart"></canvas>
                                    </div>
                                    <div class="chart-container">
                                        <div class="chart-title">P&L Timeline</div>
                                        <canvas id="pnl-timeline-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="card-controls">
                                <button class="card-control-btn" onclick="viewMore('portfolio')" title="View More">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                                <button class="card-control-btn" onclick="toggleCard('portfolio-card')" title="Expand/Collapse">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="overview-card" id="positions-card">
                            <h3>Active Positions</h3>
                            <div class="card-content">
                                <div class="position-list">
                                    <div class="position-item">
                                        <button class="chart-toggle" onclick="toggleChart(this)">
                                            <i class="fas fa-chevron-down"></i>
                                        </button>
                                        <div class="position-header">
                                            <span class="symbol">AAPL</span>
                                            <span class="value">$150.25</span>
                                            <span class="change positive">+1.25%</span>
                                            <div class="position-controls">
                                                <button class="position-btn" onclick="viewChart('AAPL')">
                                                    <i class="fas fa-chart-line"></i>
                                                </button>
                                                <button class="position-btn" onclick="viewPosition('AAPL')">
                                                    <i class="fas fa-info-circle"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mini-chart-container">
                                            <div class="mini-chart">
                                                <svg class="chart-svg" viewBox="0 0 100 40">
                                                    <polyline class="price-line" points="0,35 10,32 20,28 30,30 40,25 50,22 60,18 70,15 80,12 90,10 100,8" />
                                                    <rect class="volume-bars" x="0" y="36" width="8" height="4" />
                                                    <rect class="volume-bars" x="12" y="34" width="8" height="6" />
                                                    <rect class="volume-bars" x="24" y="35" width="8" height="5" />
                                                    <rect class="volume-bars" x="36" y="33" width="8" height="7" />
                                                    <rect class="volume-bars" x="48" y="36" width="8" height="4" />
                                                    <rect class="volume-bars" x="60" y="34" width="8" height="6" />
                                                    <rect class="volume-bars" x="72" y="35" width="8" height="5" />
                                                    <rect class="volume-bars" x="84" y="36" width="8" height="4" />
                                                </svg>
                                            </div>
                                            <div class="position-data">
                                                <div class="data-row">
                                                    <span class="data-label">Risk:</span>
                                                    <span class="data-value">Low</span>
                                                </div>
                                                <div class="data-row">
                                                    <span class="data-label">Sentiment:</span>
                                                    <span class="data-value">Bullish</span>
                                                </div>
                                                <div class="data-row">
                                                    <span class="data-label">Action:</span>
                                                    <span class="data-value">Hold</span>
                                                </div>
                                                <div class="data-row">
                                                    <span class="data-label">Target:</span>
                                                    <span class="data-value">$165</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="price-info">
                                            <div class="price-box">
                                                <span class="price-label">Bid</span>
                                                <span class="price-value">$150.20</span>
                                            </div>
                                            <div class="price-box">
                                                <span class="price-label">Ask</span>
                                                <span class="price-value">$150.30</span>
                                            </div>
                                        </div>
                                        <div class="chart-info">
                                            <span>1H</span>
                                            <span>Vol: 1.2M</span>
                                        </div>
                                    </div>
                                    
                                    <div class="position-item">
                                        <button class="chart-toggle" onclick="toggleChart(this)">
                                            <i class="fas fa-chevron-down"></i>
                                        </button>
                                        <div class="position-header">
                                            <span class="symbol">GOOGL</span>
                                            <span class="value">$2750.50</span>
                                            <span class="change negative">-0.75%</span>
                                            <div class="position-controls">
                                                <button class="position-btn" onclick="viewChart('GOOGL')">
                                                    <i class="fas fa-chart-line"></i>
                                                </button>
                                                <button class="position-btn" onclick="viewPosition('GOOGL')">
                                                    <i class="fas fa-info-circle"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mini-chart-container">
                                            <div class="mini-chart">
                                                <svg class="chart-svg" viewBox="0 0 100 40">
                                                    <polyline class="price-line" points="0,12 10,15 20,18 30,15 40,22 50,25 60,28 70,26 80,30 90,32 100,35" />
                                                    <rect class="volume-bars" x="0" y="36" width="8" height="4" />
                                                    <rect class="volume-bars" x="12" y="34" width="8" height="6" />
                                                    <rect class="volume-bars" x="24" y="37" width="8" height="3" />
                                                    <rect class="volume-bars" x="36" y="33" width="8" height="7" />
                                                    <rect class="volume-bars" x="48" y="35" width="8" height="5" />
                                                    <rect class="volume-bars" x="60" y="34" width="8" height="6" />
                                                    <rect class="volume-bars" x="72" y="36" width="8" height="4" />
                                                    <rect class="volume-bars" x="84" y="35" width="8" height="5" />
                                                </svg>
                                            </div>
                                            <div class="position-data">
                                                <div class="data-row">
                                                    <span class="data-label">Risk:</span>
                                                    <span class="data-value">Medium</span>
                                                </div>
                                                <div class="data-row">
                                                    <span class="data-label">Sentiment:</span>
                                                    <span class="data-value">Bearish</span>
                                                </div>
                                                <div class="data-row">
                                                    <span class="data-label">Action:</span>
                                                    <span class="data-value">Watch</span>
                                                </div>
                                                <div class="data-row">
                                                    <span class="data-label">Target:</span>
                                                    <span class="data-value">$2650</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="price-info">
                                            <div class="price-box">
                                                <span class="price-label">Bid</span>
                                                <span class="price-value">$2750.25</span>
                                            </div>
                                            <div class="price-box">
                                                <span class="price-label">Ask</span>
                                                <span class="price-value">$2750.75</span>
                                            </div>
                                        </div>
                                        <div class="chart-info">
                                            <span>1H</span>
                                            <span>Vol: 850K</span>
                                        </div>
                                    </div>
                                    
                                    <div class="position-item">
                                        <button class="chart-toggle" onclick="toggleChart(this)">
                                            <i class="fas fa-chevron-down"></i>
                                        </button>
                                        <div class="position-header">
                                            <span class="symbol">TSLA</span>
                                            <span class="value">$850.75</span>
                                            <span class="change positive">+3.10%</span>
                                            <div class="position-controls">
                                                <button class="position-btn" onclick="viewChart('TSLA')">
                                                    <i class="fas fa-chart-line"></i>
                                                </button>
                                                <button class="position-btn" onclick="viewPosition('TSLA')">
                                                    <i class="fas fa-info-circle"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mini-chart-container">
                                            <div class="mini-chart">
                                                <svg class="chart-svg" viewBox="0 0 100 40">
                                                    <polyline class="price-line" points="0,38 10,35 20,32 30,28 40,24 50,20 60,16 70,12 80,8 90,5 100,2" />
                                                    <rect class="volume-bars" x="0" y="36" width="8" height="4" />
                                                    <rect class="volume-bars" x="12" y="32" width="8" height="8" />
                                                    <rect class="volume-bars" x="24" y="34" width="8" height="6" />
                                                    <rect class="volume-bars" x="36" y="31" width="8" height="9" />
                                                    <rect class="volume-bars" x="48" y="33" width="8" height="7" />
                                                    <rect class="volume-bars" x="60" y="32" width="8" height="8" />
                                                    <rect class="volume-bars" x="72" y="34" width="8" height="6" />
                                                    <rect class="volume-bars" x="84" y="33" width="8" height="7" />
                                                </svg>
                                            </div>
                                            <div class="position-data">
                                                <div class="data-row">
                                                    <span class="data-label">Risk:</span>
                                                    <span class="data-value">High</span>
                                                </div>
                                                <div class="data-row">
                                                    <span class="data-label">Sentiment:</span>
                                                    <span class="data-value">Very Bullish</span>
                                                </div>
                                                <div class="data-row">
                                                    <span class="data-label">Action:</span>
                                                    <span class="data-value">Buy</span>
                                                </div>
                                                <div class="data-row">
                                                    <span class="data-label">Target:</span>
                                                    <span class="data-value">$875</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="price-info">
                                            <div class="price-box">
                                                <span class="price-label">Bid</span>
                                                <span class="price-value">$850.50</span>
                                            </div>
                                            <div class="price-box">
                                                <span class="price-label">Ask</span>
                                                <span class="price-value">$851.00</span>
                                            </div>
                                        </div>
                                        <div class="chart-info">
                                            <span>1H</span>
                                            <span>Vol: 2.5M</span>
                                        </div>
                                    </div>
                                    
                                    <div class="position-item">
                                        <button class="chart-toggle" onclick="toggleChart(this)">
                                            <i class="fas fa-chevron-down"></i>
                                        </button>
                                        <div class="position-header">
                                            <span class="symbol">MSFT</span>
                                            <span class="value">$300.40</span>
                                            <span class="change positive">+0.80%</span>
                                            <div class="position-controls">
                                                <button class="position-btn" onclick="viewChart('MSFT')">
                                                    <i class="fas fa-chart-line"></i>
                                                </button>
                                                <button class="position-btn" onclick="viewPosition('MSFT')">
                                                    <i class="fas fa-info-circle"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="mini-chart-container">
                                            <div class="mini-chart">
                                                <svg class="chart-svg" viewBox="0 0 100 40">
                                                    <polyline class="price-line" points="0,30 10,28 20,25 30,28 40,23 50,20 60,17 70,14 80,11 90,9 100,6" />
                                                    <rect class="volume-bars" x="0" y="36" width="8" height="4" />
                                                    <rect class="volume-bars" x="12" y="34" width="8" height="6" />
                                                    <rect class="volume-bars" x="24" y="35" width="8" height="5" />
                                                    <rect class="volume-bars" x="36" y="34" width="8" height="6" />
                                                    <rect class="volume-bars" x="48" y="37" width="8" height="3" />
                                                    <rect class="volume-bars" x="60" y="35" width="8" height="5" />
                                                    <rect class="volume-bars" x="72" y="36" width="8" height="4" />
                                                    <rect class="volume-bars" x="84" y="35" width="8" height="5" />
                                                </svg>
                                            </div>
                                            <div class="position-data">
                                                <div class="data-row">
                                                    <span class="data-label">Risk:</span>
                                                    <span class="data-value">Low</span>
                                                </div>
                                                <div class="data-row">
                                                    <span class="data-label">Sentiment:</span>
                                                    <span class="data-value">Neutral</span>
                                                </div>
                                                <div class="data-row">
                                                    <span class="data-label">Action:</span>
                                                    <span class="data-value">Hold</span>
                                                </div>
                                                <div class="data-row">
                                                    <span class="data-label">Target:</span>
                                                    <span class="data-value">$315</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="price-info">
                                            <div class="price-box">
                                                <span class="price-label">Bid</span>
                                                <span class="price-value">$300.35</span>
                                            </div>
                                            <div class="price-box">
                                                <span class="price-label">Ask</span>
                                                <span class="price-value">$300.45</span>
                                            </div>
                                        </div>
                                        <div class="chart-info">
                                            <span>1H</span>
                                            <span>Vol: 950K</span>
                                        </div>
                                    </div>
                                    
                                    <!-- More positions when expanded... -->
                                </div>
                            </div>
                            <div class="card-controls">
                                <button class="card-control-btn" onclick="viewMore('positions')" title="View More">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                                <button class="card-control-btn" onclick="toggleCard('positions-card')" title="Expand/Collapse">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="signals-overview" id="signals-card">
                            <h3>Trading Signals</h3>
                            <div class="card-content">
                                <div class="signals-sections">
                                    <div class="signal-section">
                                        <h4><i class="fas fa-play-circle"></i> Ongoing Signals</h4>
                                        <div class="signal-section-list">
                                            <div class="signal-item">
                                                <div class="signal-overview">
                                                    <span class="signal-type buy">BUY</span>
                                                    <span class="signal-symbol">TSLA</span>
                                                    <span class="trade-tier">T3</span>
                                                    <span class="elapsed-time">5m ago</span>
                                                    <span>85%</span>
                                                    <span>$875</span>
                                                    <span>Active</span>
                                                </div>
                                                <div class="signal-details">
                                                    <div class="detail-row">
                                                        <span class="detail-label">Probability:</span>
                                                        <span class="detail-value">85%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Portfolio %:</span>
                                                        <span class="detail-value">3.5%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Multiplier:</span>
                                                        <span class="detail-value">2.5x</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Est. ROI:</span>
                                                        <span class="detail-value">+12.5%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Price Target:</span>
                                                        <span class="detail-value">$875 (+2.9%)</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Entry-Exit:</span>
                                                        <span class="detail-value">$850-$875</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Est. Hold Time:</span>
                                                        <span class="detail-value">3-5 days</span>
                                                    </div>
                                                </div>
                                                <div class="signal-actions">
                                                    <button class="execute-trade-btn">Execute Trade</button>
                                                    <button class="delete-signal-btn">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="signal-item">
                                                <div class="signal-overview">
                                                    <span class="signal-type sell">SELL</span>
                                                    <span class="signal-symbol">MSFT</span>
                                                    <span class="trade-tier">T2</span>
                                                    <span class="elapsed-time">15m ago</span>
                                                    <span>72%</span>
                                                    <span>$285</span>
                                                    <span>Active</span>
                                                </div>
                                                <div class="signal-details">
                                                    <div class="detail-row">
                                                        <span class="detail-label">Probability:</span>
                                                        <span class="detail-value">72%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Portfolio %:</span>
                                                        <span class="detail-value">2.8%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Multiplier:</span>
                                                        <span class="detail-value">1.5x</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Est. ROI:</span>
                                                        <span class="detail-value">-5.2%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Price Target:</span>
                                                        <span class="detail-value">$285 (-5.2%)</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Entry-Exit:</span>
                                                        <span class="detail-value">$300-$285</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Est. Hold Time:</span>
                                                        <span class="detail-value">1-2 days</span>
                                                    </div>
                                                </div>
                                                <div class="signal-actions">
                                                    <button class="execute-trade-btn">Execute Trade</button>
                                                    <button class="delete-signal-btn">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="signal-section">
                                        <h4><i class="fas fa-clock"></i> Forming Set Ups</h4>
                                        <div class="signal-section-list">
                                            <div class="signal-item">
                                                <div class="signal-overview">
                                                    <span class="signal-type watch">WATCH</span>
                                                    <span class="signal-symbol">NVDA</span>
                                                    <span class="trade-tier">T4</span>
                                                    <span class="elapsed-time">2m ago</span>
                                                    <span>78%</span>
                                                    <span>$460</span>
                                                    <span>Forming</span>
                                                </div>
                                                <div class="signal-details">
                                                    <div class="detail-row">
                                                        <span class="detail-label">Probability:</span>
                                                        <span class="detail-value">78%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Pattern:</span>
                                                        <span class="detail-value">Bull Flag</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Confidence:</span>
                                                        <span class="detail-value">75%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Entry Price:</span>
                                                        <span class="detail-value">$460.00</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Formation:</span>
                                                        <span class="detail-value">65% Complete</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="signal-item">
                                                <div class="signal-overview">
                                                    <span class="signal-type watch">WATCH</span>
                                                    <span class="signal-symbol">AMD</span>
                                                    <span class="trade-tier">T2</span>
                                                    <span class="elapsed-time">8m ago</span>
                                                    <span>68%</span>
                                                    <span>$122</span>
                                                    <span>Setup</span>
                                                </div>
                                                <div class="signal-details">
                                                    <div class="detail-row">
                                                        <span class="detail-label">Probability:</span>
                                                        <span class="detail-value">68%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Pattern:</span>
                                                        <span class="detail-value">Support Test</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Confidence:</span>
                                                        <span class="detail-value">68%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Entry Price:</span>
                                                        <span class="detail-value">$122.00</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Formation:</span>
                                                        <span class="detail-value">45% Complete</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="signal-section">
                                        <h4><i class="fas fa-shield-alt"></i> Hedge Signals</h4>
                                        <div class="signal-section-list">
                                            <div class="signal-item">
                                                <div class="signal-overview">
                                                    <span class="signal-type hedge">HEDGE</span>
                                                    <span class="signal-symbol">SPY</span>
                                                    <span class="trade-tier">T1</span>
                                                    <span class="elapsed-time">30m ago</span>
                                                    <span>65%</span>
                                                    <span>$430</span>
                                                    <span>Active</span>
                                                </div>
                                                <div class="signal-details">
                                                    <div class="detail-row">
                                                        <span class="detail-label">Probability:</span>
                                                        <span class="detail-value">65%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Portfolio %:</span>
                                                        <span class="detail-value">1.2%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Type:</span>
                                                        <span class="detail-value">Put Protection</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Risk Reduction:</span>
                                                        <span class="detail-value">15%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Cost:</span>
                                                        <span class="detail-value">$450/contract</span>
                                                    </div>
                                                </div>
                                                <div class="signal-actions">
                                                    <button class="execute-trade-btn">Execute Trade</button>
                                                    <button class="delete-signal-btn">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="signal-section">
                                        <h4><i class="fas fa-history"></i> Past Signals</h4>
                                        <div class="signal-section-list">
                                            <div class="signal-item">
                                                <div class="signal-overview">
                                                    <span class="signal-type buy">BUY</span>
                                                    <span class="signal-symbol">META</span>
                                                    <span class="trade-tier">T5</span>
                                                    <span class="elapsed-time">2d ago</span>
                                                    <span>82%</span>
                                                    <span>$345.60</span>
                                                    <span>+8%</span>
                                                </div>
                                                <div class="signal-details">
                                                    <div class="detail-row">
                                                        <span class="detail-label">Probability:</span>
                                                        <span class="detail-value">82%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Entry Price:</span>
                                                        <span class="detail-value">$320.00</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Exit Price:</span>
                                                        <span class="detail-value">$345.60</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Profit:</span>
                                                        <span class="detail-value">$2,400</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Duration:</span>
                                                        <span class="detail-value">3 days</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-controls">
                                <button class="card-control-btn" onclick="viewMore('signals')" title="View More">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                                <button class="card-control-btn" onclick="toggleCard('signals-card')" title="Expand/Collapse">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Remaining cards continue with same structure... -->
                        <!-- I'll include them in Part 4 -->
                        
                    </div>
                </section>

                <!-- Terminal Section -->
                <section id="terminal" class="content-section">
                    {% include 'components/terminal.html' %}
                </section>

                <!-- Other sections would be included here -->
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/dashboard.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Fixed sidebar toggle functionality
document.getElementById('sidebar-toggle').addEventListener('click', function() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('retracted');
});

// News filter functionality
document.querySelectorAll('.news-filter-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.news-filter-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        const filter = this.dataset.filter;
        document.querySelectorAll('.news-item').forEach(item => {
            if (filter === 'all' || item.dataset.type === filter) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    });
});

// Chart toggle functionality
function toggleChart(button) {
    const container = button.parentElement.querySelector('.mini-chart-container');
    const icon = button.querySelector('i');
    
    button.classList.toggle('locked');
    container.classList.toggle('show');
    
    if (button.classList.contains('locked')) {
        icon.className = 'fas fa-chevron-up';
    } else {
        icon.className = 'fas fa-chevron-down';
    }
}

// Card toggle functionality
function toggleCard(cardId) {
    const card = document.getElementById(cardId);
    const icon = card.querySelector('.card-controls .fa-expand, .card-controls .fa-compress');
    
    card.classList.toggle('expanded');
    
    if (card.classList.contains('expanded')) {
        icon.className = 'fas fa-compress';
    } else {
        icon.className = 'fas fa-expand';
    }
}

// View more functionality
function viewMore(section) {
    console.log('Opening detailed view for:', section);
    window.location.href = `/${section}`;
}

// Position functions
function viewChart(symbol) {
    console.log('Opening chart for:', symbol);
    window.location.href = `/chart/${symbol}`;
}

function viewPosition(symbol) {
    console.log('Opening position details for:', symbol);
    window.location.href = `/position/${symbol}`;
}

// Bulk actions
document.getElementById('bulk-actions-btn').addEventListener('click', function() {
    this.parentElement.classList.toggle('active');
});

function toggleAllCards(action) {
    const cards = document.querySelectorAll('.overview-card');
    cards.forEach(card => {
        if (action === 'expand' && !card.classList.contains('expanded')) {
            toggleCard(card.id);
        } else if (action === 'collapse' && card.classList.contains('expanded')) {
            toggleCard(card.id);
        }
    });
    document.querySelector('.bulk-actions').classList.remove('active');
}

function showCardManager() {
    console.log('Opening card manager...');
    document.querySelector('.bulk-actions').classList.remove('active');
}

function resetLayout() {
    console.log('Resetting layout...');
    document.querySelector('.bulk-actions').classList.remove('active');
}

// Status ticker functionality
document.querySelectorAll('.status-item').forEach(item => {
    item.addEventListener('click', function() {
        this.classList.toggle('expanded');
    });
});

// Update time and ping
function updateTimeAndPing() {
    const now = new Date();
    document.getElementById('local-time').textContent = now.toLocaleTimeString();
    
    // Simulate ping variation
    const ping = 10 + Math.random() * 10;
    document.getElementById('ping-value').textContent = Math.round(ping);
}

updateTimeAndPing();
setInterval(updateTimeAndPing, 1000);

// Update notification counts
function updateNotificationCounts() {
    const notifications = Math.floor(Math.random() * 5);
    const activities = Math.floor(Math.random() * 3);
    const alerts = Math.floor(Math.random() * 2);
    
    updateIconCount('notifications-icon', notifications);
    updateIconCount('activity-icon', activities);
    updateIconCount('alerts-icon', alerts);
}

function updateIconCount(iconId, count) {
    const icon = document.getElementById(iconId);
    const countEl = icon.querySelector('.icon-count');
    
    if (count > 0) {
        icon.classList.add('has-items');
        countEl.textContent = count;
        countEl.style.display = 'flex';
    } else {
        icon.classList.remove('has-items');
        countEl.style.display = 'none';
    }
}

// Simulate updates
updateNotificationCounts();
setInterval(updateNotificationCounts, 30000);

// Make news items clickable
document.querySelectorAll('.news-item').forEach(item => {
    item.addEventListener('click', function() {
        console.log('Opening article...');
    });
});

// Initialize portfolio charts when card is expanded
let chartsInitialized = false;
const originalToggleCard = toggleCard;
toggleCard = function(cardId) {
    originalToggleCard(cardId);
    
    if (cardId === 'portfolio-card' && !chartsInitialized) {
        initializePortfolioCharts();
        chartsInitialized = true;
    }
};

function initializePortfolioCharts() {
    // Portfolio Performance Chart
    const perfCtx = document.getElementById('portfolio-performance-chart');
    if (perfCtx) {
        new Chart(perfCtx.getContext('2d'), {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Portfolio Value',
                    data: [100000, 105000, 108000, 115000, 120000, 125847],
                    borderColor: '#00ff41',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        ticks: { color: '#00ff41' },
                        grid: { color: '#333' }
                    },
                    x: {
                        ticks: { color: '#00ff41' },
                        grid: { color: '#333' }
                    }
                }
            }
        });
    }
    
    // Asset Allocation Chart
    const allocCtx = document.getElementById('asset-allocation-chart');
    if (allocCtx) {
        new Chart(allocCtx.getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: ['Tech', 'Finance', 'Healthcare', 'Energy', 'Cash'],
                datasets: [{
                    data: [35, 20, 15, 18, 12],
                    backgroundColor: [
                        '#00ff41',
                        '#00cc33',
                        '#008822',
                        '#ff6600',
                        '#333333'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#00ff41' }
                    }
                }
            }
        });
    }
}
</script>
{% endblock %}