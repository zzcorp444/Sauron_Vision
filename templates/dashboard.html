<!-- templates/dashboard.html -->
{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-left">
            <img src="{% static 'images/sv_logo_00.png' %}" alt="SV" class="header-logo">
            <h1>SAURON VISION</h1>
        </div>
        <div class="header-center">
            <div class="market-status">
                <span class="status-indicator active"></span>
                <span>MARKET {{ market_status }}</span>
                
                <!-- Market Status Popup -->
                <div class="market-status-popup">
                    <div class="market-group">
                        <h4><i class="fas fa-circle" style="color: var(--primary-text);"></i> Open Markets</h4>
                        <div class="market-list">
                            <div class="market-item open">
                                <span class="market-name">NYSE</span>
                                <span class="market-time">9:30 AM - 4:00 PM EST</span>
                            </div>
                            <div class="market-item open">
                                <span class="market-name">NASDAQ</span>
                                <span class="market-time">9:30 AM - 4:00 PM EST</span>
                            </div>
                            <div class="market-item open">
                                <span class="market-name">London Stock Exchange</span>
                                <span class="market-time">8:00 AM - 4:30 PM GMT</span>
                            </div>
                            <div class="market-item open">
                                <span class="market-name">Crypto (24/7)</span>
                                <span class="market-time">Always Open</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="market-group">
                        <h4><i class="fas fa-circle" style="color: var(--error-text);"></i> Closed Markets</h4>
                        <div class="market-list">
                            <div class="market-item closed">
                                <span class="market-name">Tokyo Stock Exchange</span>
                                <span class="market-time">9:00 AM - 3:00 PM JST</span>
                            </div>
                            <div class="market-item closed">
                                <span class="market-name">Shanghai Exchange</span>
                                <span class="market-time">9:30 AM - 3:00 PM CST</span>
                            </div>
                            <div class="market-item closed">
                                <span class="market-name">Hong Kong Exchange</span>
                                <span class="market-time">9:30 AM - 4:00 PM HKT</span>
                            </div>
                            <div class="market-item closed">
                                <span class="market-name">Sydney Exchange</span>
                                <span class="market-time">10:00 AM - 4:00 PM AEDT</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="settings-icon" title="Settings">
                    <i class="fas fa-cog"></i>
                    <div class="hover-tooltip">Settings</div>
                </div>
                <span class="user-id-text">{{ user.user_id }}</span>
                <div class="hover-tooltip">Profile</div>
                <div class="notifications-group">
                    <div class="notification-icon" data-count="0">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count">0</span>
                        <div class="notification-popup">
                            <div class="popup-header">
                                <h4>Notifications</h4>
                                <button class="view-all-btn">View All</button>
                            </div>
                            <div class="popup-content">
                                <div class="notification-item">
                                    <i class="fas fa-check-circle"></i>
                                    <div class="notification-text">
                                        <strong>Trade Executed</strong>
                                        <p>AAPL Buy order completed</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="activity-icon" data-count="0">
                        <i class="fas fa-chart-line"></i>
                        <span class="activity-count">0</span>
                        <div class="activity-popup">
                            <div class="popup-header">
                                <h4>Activity</h4>
                                <button class="view-all-btn">View All</button>
                            </div>
                            <div class="popup-content">
                                <div class="activity-item">
                                    <i class="fas fa-sync"></i>
                                    <div class="activity-text">
                                        <strong>Strategy Running</strong>
                                        <p>Mean Reversion active</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="alert-icon" data-count="{{ active_alerts }}">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span class="alert-count">{{ active_alerts }}</span>
                        <div class="alert-popup">
                            <div class="popup-header">
                                <h4>Alerts</h4>
                                <button class="view-all-btn">View All</button>
                            </div>
                            <div class="popup-content">
                                <div class="alert-item">
                                    <i class="fas fa-warning"></i>
                                    <div class="alert-text">
                                        <strong>Risk Warning</strong>
                                        <p>Portfolio volatility increased</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <a href="{% url 'logout' %}" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
            </a>
        </div>
    </header>

    <!-- Information Bar -->
    <div class="info-bar">
        <div class="info-bar-content">
            <div class="info-item">
                <i class="fas fa-brain"></i>
                <span class="info-title">AI Analysis Running</span>
                <div class="info-details">
                    <p>Deep learning models analyzing 50+ assets in real-time</p>
                </div>
            </div>
            <div class="info-item">
                <i class="fas fa-shield-alt"></i>
                <span class="info-title">Risk Management Active</span>
                <div class="info-details">
                    <p>Portfolio protected with dynamic hedging strategies</p>
                </div>
            </div>
            <div class="info-item">
                <i class="fas fa-newspaper"></i>
                <span class="info-title">Breaking: Fed Meeting Today</span>
                <div class="info-details">
                    <p>Federal Reserve interest rate decision at 2:00 PM EST</p>
                </div>
            </div>
            <div class="info-item">
                <i class="fas fa-robot"></i>
                <span class="info-title">3 Strategies Executing</span>
                <div class="info-details">
                    <p>Mean Reversion, Momentum, and Pairs Trading active</p>
                </div>
            </div>
            <div class="info-item">
                <i class="fas fa-satellite"></i>
                <span class="info-title">Satellite Data Processed</span>
                <div class="info-details">
                    <p>Alternative data showing increased retail traffic +5.2%</p>
                </div>
            </div>
            <div class="info-item">
                <i class="fas fa-network-wired"></i>
                <span class="info-title">Neural Network Training</span>
                <div class="info-details">
                    <p>Model accuracy improved to 87.3% on test data</p>
                </div>
            </div>
            <div class="info-item">
                <i class="fas fa-globe"></i>
                <span class="info-title">Global Markets Update</span>
                <div class="info-details">
                    <p>Asian markets closed mixed, European markets up 0.5%</p>
                </div>
            </div>
            <div class="info-item">
                <i class="fas fa-bolt"></i>
                <span class="info-title">High Frequency Trading</span>
                <div class="info-details">
                    <p>Executed 1,247 micro-trades with 0.02ms latency</p>
                </div>
            </div>
            <div class="info-item">
                <i class="fas fa-comments"></i>
                <span class="info-title">Social Sentiment Surge</span>
                <div class="info-details">
                    <p>Bullish sentiment on TSLA increased 35% in last hour</p>
                </div>
            </div>
            <div class="info-item">
                <i class="fas fa-server"></i>
                <span class="info-title">System Performance</span>
                <div class="info-details">
                    <p>All systems operational, 99.98% uptime this month</p>
                </div>
            </div>
            <!-- Duplicate for continuous scroll -->
            <div class="info-item">
                <i class="fas fa-brain"></i>
                <span class="info-title">AI Analysis Running</span>
                <div class="info-details">
                    <p>Deep learning models analyzing 50+ assets in real-time</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Layout -->
    <div class="dashboard-layout">
        <!-- News Intelligence Bar - Behind Sidebar -->
        <div class="news-intelligence-bar" id="news-bar">
            <div class="news-bar-header">
                <div class="news-bar-title">
                    <i class="fas fa-newspaper"></i>
                    <span>Market Intelligence</span>
                </div>
                <div class="news-bar-controls">
                    <button class="news-filter-btn active" data-filter="all">All</button>
                    <button class="news-filter-btn" data-filter="news">News</button>
                    <button class="news-filter-btn" data-filter="social">Social</button>
                    <button class="news-filter-btn" data-filter="analysis">Analysis</button>
                    <button class="news-filter-btn" data-filter="alerts">Alerts</button>
                </div>
            </div>
            
            <div class="news-content">
                <!-- News Items -->
                <div class="news-item" data-type="news">
                    <div class="news-source">
                        <span class="news-source-name">Bloomberg</span>
                        <span class="news-time">2 min ago</span>
                    </div>
                    <h4 class="news-headline">Fed Signals Pause in Rate Hikes as Inflation Shows Signs of Cooling</h4>
                    <p class="news-summary">Federal Reserve officials indicated they may hold interest rates steady in the upcoming meeting...</p>
                    <div class="news-meta">
                        <div class="sentiment-indicator positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>Bullish</span>
                        </div>
                        <div class="social-metrics">
                            <span class="social-metric"><i class="fab fa-twitter"></i> 1.2k</span>
                            <span class="social-metric"><i class="fas fa-comments"></i> 342</span>
                        </div>
                    </div>
                    <div class="news-tags">
                        <span class="news-tag">Fed</span>
                        <span class="news-tag">Rates</span>
                        <span class="news-tag ticker">SPY</span>
                    </div>
                </div>
                
                <div class="news-item" data-type="social">
                    <div class="news-source">
                        <span class="news-source-name">Reddit - WSB</span>
                        <span class="news-time">5 min ago</span>
                    </div>
                    <h4 class="news-headline">Unusual Options Activity Detected on NVDA</h4>
                    <p class="news-summary">Massive call option purchases for NVDA $500 strike...</p>
                    <div class="news-meta">
                        <div class="sentiment-indicator positive">
                            <i class="fas fa-fire"></i>
                            <span>Hot</span>
                        </div>
                        <div class="social-metrics">
                            <span class="social-metric"><i class="fas fa-arrow-up"></i> 5.8k</span>
                        </div>
                    </div>
                    <div class="news-tags">
                        <span class="news-tag ticker">NVDA</span>
                        <span class="news-tag">Options</span>
                    </div>
                </div>
                
                <div class="news-item" data-type="analysis">
                    <div class="news-source">
                        <span class="news-source-name">Sauron AI</span>
                        <span class="news-time">10 min ago</span>
                    </div>
                    <h4 class="news-headline">Pattern Alert: AAPL Ascending Triangle</h4>
                    <p class="news-summary">Bullish pattern formation with 85% success rate...</p>
                    <div class="news-meta">
                        <div class="sentiment-indicator positive">
                            <i class="fas fa-chart-line"></i>
                            <span>Buy Signal</span>
                        </div>
                    </div>
                    <div class="news-tags">
                        <span class="news-tag ticker">AAPL</span>
                        <span class="news-tag">Technical</span>
                    </div>
                </div>
                
                <div class="news-item" data-type="news">
                    <div class="news-source">
                        <span class="news-source-name">Reuters</span>
                        <span class="news-time">15 min ago</span>
                    </div>
                    <h4 class="news-headline">Tesla Q4 Deliveries Beat Estimates</h4>
                    <p class="news-summary">484,507 vehicles delivered, beating expectations...</p>
                    <div class="news-meta">
                        <div class="sentiment-indicator positive">
                            <i class="fas fa-rocket"></i>
                            <span>Bullish</span>
                        </div>
                    </div>
                    <div class="news-tags">
                        <span class="news-tag ticker">TSLA</span>
                        <span class="news-tag">Earnings</span>
                    </div>
                </div>
                
                <!-- More news items... -->
            </div>
        </div>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <button class="sidebar-toggle" id="sidebar-toggle">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <nav class="nav-menu">
                    <a href="#" class="nav-item active" data-section="vision">
                        <i class="fas fa-eye"></i>
                        <div class="nav-text">
                            <span class="nav-main">Vision</span>
                            <span class="nav-sub">Overview/Dashboard</span>
                        </div>
                    </a>
                    <a href="#" class="nav-item" data-section="market">
                        <i class="fas fa-search"></i>
                        <div class="nav-text">
                            <span class="nav-main">Market</span>
                            <span class="nav-sub">Scanner & Intelligence</span>
                        </div>
                    </a>
                    <a href="#" class="nav-item" data-section="strategy">
                        <i class="fas fa-cogs"></i>
                        <div class="nav-text">
                            <span class="nav-main">Strategy</span>
                            <span class="nav-sub">Builder & Generation</span>
                        </div>
                    </a>
                    <a href="#" class="nav-item" data-section="risk">
                        <i class="fas fa-shield-alt"></i>
                        <div class="nav-text">
                            <span class="nav-main">Risk</span>
                            <span class="nav-sub">Management & Metrics</span>
                        </div>
                    </a>
                    <a href="#" class="nav-item" data-section="sentiment">
                        <i class="fas fa-brain"></i>
                        <div class="nav-text">
                            <span class="nav-main">Sentiment</span>
                            <span class="nav-sub">Analysis & Indicators</span>
                        </div>
                    </a>
                    <a href="#" class="nav-item" data-section="execution">
                        <i class="fas fa-bolt"></i>
                        <div class="nav-text">
                            <span class="nav-main">Execution</span>
                            <span class="nav-sub">Trading & Orders</span>
                        </div>
                    </a>
                    <a href="#" class="nav-item" data-section="anomaly">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="nav-text">
                            <span class="nav-main">Anomaly</span>
                            <span class="nav-sub">Detection & Alerts</span>
                        </div>
                    </a>
                    <a href="#" class="nav-item" data-section="terminal">
                        <i class="fas fa-terminal"></i>
                        <div class="nav-text">
                            <span class="nav-main">Terminal</span>
                            <span class="nav-sub">Console Interface</span>
                        </div>
                    </a>
                </nav>
            </aside>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Vision Section (Overview) -->
                <section id="vision" class="content-section active">
                    <div class="section-header">
                        <h2>Market Overview</h2>
                        <div class="section-controls">
                            <button class="control-btn">
                                <i class="fas fa-refresh"></i>
                            </button>
                            <div class="bulk-actions">
                                <button class="control-btn bulk-action-btn">
                                    <i class="fas fa-layer-group"></i>
                                    <span>Bulk Actions</span>
                                </button>
                                <div class="bulk-actions-menu">
                                    <button class="bulk-action-item" data-action="expand-all">
                                        <i class="fas fa-expand"></i> Expand All Cards
                                    </button>
                                    <button class="bulk-action-item" data-action="collapse-all">
                                        <i class="fas fa-compress"></i> Collapse All Cards
                                    </button>
                                    <button class="bulk-action-item" data-action="add-card">
                                        <i class="fas fa-plus"></i> Add Card
                                    </button>
                                    <button class="bulk-action-item" data-action="remove-card">
                                        <i class="fas fa-minus"></i> Remove Card
                                    </button>
                                    <button class="bulk-action-item" data-action="reset-layout">
                                        <i class="fas fa-undo"></i> Reset Layout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="overview-grid">
                        <div class="overview-card fixed-height" data-card-id="portfolio-status">
                            <h3>Portfolio Status</h3>
                            <div class="card-controls">
                                <button class="card-expand-btn" title="Expand/Collapse">
                                    <i class="fas fa-expand-alt"></i>
                                </button>
                                <button class="card-more-btn" title="View More">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                            </div>
                            <div class="card-content scrollable">
                                <div class="portfolio-grid">
                                    <div class="metric">
                                        <span class="value">$125,847</span>
                                        <span class="label">Total Value</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value">$15,234</span>
                                        <span class="label">Available Cash</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value positive">+2.35%</span>
                                        <span class="label">Today's Change</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value positive">+$2,847</span>
                                        <span class="label">Today's P&L</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value">6</span>
                                        <span class="label">Active Positions</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value warning">Medium</span>
                                        <span class="label">Risk Level</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value">1.15</span>
                                        <span class="label">Portfolio Beta</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value positive">8.7</span>
                                        <span class="label">Portfolio Score</span>
                                    </div>
                                    <!-- Extended content when expanded -->
                                    <div class="extended-content">
                                        <div class="portfolio-chart">
                                            <canvas id="portfolio-allocation-chart"></canvas>
                                        </div>
                                        <div class="portfolio-performance">
                                            <canvas id="portfolio-performance-chart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="overview-card fixed-height" data-card-id="active-positions">
                            <h3>Portfolio</h3>
                            <div class="card-controls">
                                <button class="card-expand-btn" title="Expand/Collapse">
                                    <i class="fas fa-expand-alt"></i>
                                </button>
                                <button class="card-more-btn" title="View More">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                            </div>
                            <div class="card-content scrollable">
                                <div class="portfolio-tabs">
                                    <button class="tab-btn active" data-tab="positions">Active Positions</button>
                                    <button class="tab-btn" data-tab="orders">Orders to Market</button>
                                </div>
                                
                                <div class="tab-content" id="positions-tab">
                                    <div class="position-list">
                                        <div class="position-item">
                                            <button class="chart-toggle" onclick="toggleChart(this)">
                                                <i class="fas fa-chevron-down"></i>
                                            </button>
                                            <div class="position-header">
                                                <span class="symbol">AAPL</span>
                                                <span class="value">$150.25</span>
                                                <span class="change positive">+1.25%</span>
                                            </div>
                                            <div class="position-prices">
                                                <div class="price-pair">
                                                    <span class="bid">Bid: $150.20</span>
                                                    <span class="ask">Ask: $150.30</span>
                                                </div>
                                                <div class="position-actions">
                                                    <button class="action-btn chart-btn" title="View Chart">
                                                        <i class="fas fa-chart-line"></i>
                                                    </button>
                                                    <button class="action-btn details-btn" title="View Details">
                                                        <i class="fas fa-info-circle"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="mini-chart-container">
                                                <div class="mini-chart">
                                                    <svg class="chart-svg">
                                                        <polyline class="price-line" points="0,25 15,23 30,20 45,22 60,18 75,16 90,14 100,12" />
                                                        <rect class="volume-bars" x="0" y="26" width="8" height="4" />
                                                        <rect class="volume-bars" x="15" y="24" width="8" height="6" />
                                                        <rect class="volume-bars" x="30" y="25" width="8" height="5" />
                                                        <rect class="volume-bars" x="45" y="23" width="8" height="7" />
                                                        <rect class="volume-bars" x="60" y="26" width="8" height="4" />
                                                        <rect class="volume-bars" x="75" y="24" width="8" height="6" />
                                                        <rect class="volume-bars" x="90" y="25" width="8" height="5" />
                                                    </svg>
                                                </div>
                                                <div class="position-data">
                                                    <div class="data-row">
                                                        <span class="data-label">Risk:</span>
                                                        <span class="data-value">Low</span>
                                                    </div>
                                                    <div class="data-row">
                                                        <span class="data-label">Sentiment:</span>
                                                        <span class="data-value">Bullish</span>
                                                    </div>
                                                    <div class="data-row">
                                                        <span class="data-label">Action:</span>
                                                        <span class="data-value">Hold</span>
                                                    </div>
                                                    <div class="data-row">
                                                        <span class="data-label">Target:</span>
                                                        <span class="data-value">$165</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="chart-info">
                                                <span>1H</span>
                                                <span>Vol: 1.2M</span>
                                            </div>
                                        </div>
                                        
                                        <!-- More position items... -->
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="orders-tab" style="display: none;">
                                    <div class="order-list">
                                        <div class="order-item">
                                            <div class="order-header">
                                                <span class="order-symbol">MSFT</span>
                                                <span class="order-type buy">BUY LIMIT</span>
                                                <span class="order-status pending">PENDING</span>
                                            </div>
                                            <div class="order-details">
                                                <span>Price: $299.50</span>
                                                <span>Qty: 100</span>
                                                <span>Value: $29,950</span>
                                            </div>
                                            <div class="order-actions">
                                                <button class="order-action-btn modify">Modify</button>
                                                <button class="order-action-btn cancel">Cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="signals-overview fixed-height" data-card-id="trading-signals">
                            <h3>Trading Signals</h3>
                            <div class="card-controls">
                                <button class="card-expand-btn" title="Expand/Collapse">
                                    <i class="fas fa-expand-alt"></i>
                                </button>
                                <button class="card-more-btn" title="View More">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                            </div>
                            <div class="card-content scrollable">
                                <div class="signals-sections">
                                    <div class="signal-section">
                                        <h4><i class="fas fa-play-circle"></i> Ongoing Signals</h4>
                                        <div class="signal-section-list">
                                            <div class="signal-item">
                                                <div class="signal-header">
                                                    <span class="signal-type buy">BUY</span>
                                                    <span class="signal-symbol">TSLA</span>
                                                    <span class="signal-tier">Tier 3</span>
                                                    <span class="signal-time">Active - 2h 15m</span>
                                                </div>
                                                <div class="signal-details always-visible">
                                                    <div class="detail-row">
                                                        <span class="detail-label">Probability:</span>
                                                        <span class="detail-value">85%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Portfolio %:</span>
                                                        <span class="detail-value">5.2%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Multiplier:</span>
                                                        <span class="detail-value">2.5x</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Est. ROI:</span>
                                                        <span class="detail-value positive">+12.5%</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Price Target:</span>
                                                        <span class="detail-value">$875 (+2.9%)</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Entry Time:</span>
                                                        <span class="detail-value">10:45 AM</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span class="detail-label">Est. Hold Time:</span>
                                                        <span class="detail-value">4-6 hours</span>
                                                    </div>
                                                </div>
                                                <div class="signal-actions">
                                                    <button class="execute-trade-btn">
                                                        <i class="fas fa-bolt"></i> Execute Trade
                                                    </button>
                                                    <button class="delete-signal-btn">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <!-- More signal items... -->
                                        </div>
                                    </div>
                                    
                                    <div class="signal-section">
                                        <h4><i class="fas fa-clock"></i> Forming Set Ups</h4>
                                        <div class="signal-section-list">
                                            <!-- Signal items -->
                                        </div>
                                    </div>
                                    
                                    <div class="signal-section">
                                        <h4><i class="fas fa-shield-alt"></i> Hedge Signals</h4>
                                        <div class="signal-section-list">
                                            <!-- Signal items -->
                                        </div>
                                    </div>
                                    
                                    <div class="signal-section">
                                        <h4><i class="fas fa-history"></i> Past Signals</h4>
                                        <div class="signal-section-list">
                                            <!-- Signal items -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Risk Monitoring Card -->
                        <div class="overview-card fixed-height" data-card-id="risk-monitoring">
                            <h3>Risk Monitoring</h3>
                            <div class="card-controls">
                                <button class="card-expand-btn" title="Expand/Collapse">
                                    <i class="fas fa-expand-alt"></i>
                                </button>
                                <button class="card-more-btn" title="View More">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                            </div>
                            <div class="card-content scrollable">
                                <div class="risk-metrics">
                                    <div class="risk-item">
                                        <span class="risk-label">Portfolio VaR (1d):</span>
                                        <span class="risk-value negative">-$2,845</span>
                                    </div>
                                    <div class="risk-item">
                                        <span class="risk-label">Current Volatility:</span>
                                        <span class="risk-value">18.5%</span>
                                    </div>
                                    <div class="risk-item">
                                        <span class="risk-label">Max Drawdown:</span>
                                        <span class="risk-value negative">-8.3%</span>
                                    </div>
                                    <div class="risk-item">
                                        <span class="risk-label">Risk Score:</span>
                                        <span class="risk-value warning">6.5/10</span>
                                    </div>
                                    <div class="risk-item">
                                        <span class="risk-label">Correlation Risk:</span>
                                        <span class="risk-value">Medium</span>
                                    </div>
                                    <div class="risk-item">
                                        <span class="risk-label">Liquidity Risk:</span>
                                        <span class="risk-value positive">Low</span>
                                    </div>
                                    <div class="risk-item">
                                        <span class="risk-label">Concentration:</span>
                                        <span class="risk-value">25% AAPL</span>
                                    </div>
                                    <div class="risk-item">
                                        <span class="risk-label">Beta Weighted:</span>
                                        <span class="risk-value">1.15</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Portfolio Management Directives -->
                        <div class="overview-card fixed-height" data-card-id="portfolio-directives">
                            <h3>Portfolio Management Directives</h3>
                            <div class="card-controls">
                                <button class="card-expand-btn" title="Expand/Collapse">
                                    <i class="fas fa-expand-alt"></i>
                                </button>
                                <button class="card-more-btn" title="View More">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                            </div>
                            <div class="card-content scrollable">
                                <div class="directive-list">
                                    <div class="directive-item priority-high">
                                        <i class="fas fa-exclamation-circle"></i>
                                        <div class="directive-content">
                                            <strong>Reduce Tech Exposure</strong>
                                            <p>Tech allocation at 45%, target 35%</p>
                                        </div>
                                    </div>
                                    <div class="directive-item priority-medium">
                                        <i class="fas fa-balance-scale"></i>
                                        <div class="directive-content">
                                            <strong>Rebalance Required</strong>
                                            <p>Quarterly rebalance due in 5 days</p>
                                        </div>
                                    </div>
                                    <div class="directive-item priority-low">
                                        <i class="fas fa-chart-line"></i>
                                        <div class="directive-content">
                                            <strong>Take Profits on NVDA</strong>
                                            <p>Position up 45%, consider partial exit</p>
                                        </div>
                                    </div>
                                    <div class="directive-item priority-info">
                                        <i class="fas fa-info-circle"></i>
                                        <div class="directive-content">
                                            <strong>Add Defensive Assets</strong>
                                            <p>Consider bonds or gold allocation</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Market Analysis Card -->
                        <div class="overview-card fixed-height" data-card-id="ai-analysis">
                            <h3>AI Market Analysis</h3>
                            <div class="card-controls">
                                <button class="card-expand-btn" title="Expand/Collapse">
                                    <i class="fas fa-expand-alt"></i>
                                </button>
                                <button class="card-more-btn" title="View More">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                            </div>
                            <div class="card-content scrollable">
                                <div class="ai-insight">
                                    <span class="insight-label">Market Sentiment:</span>
                                    <span class="insight-value positive">Bullish (72%)</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Trend Strength:</span>
                                    <span class="insight-value">Strong Uptrend</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Risk Level:</span>
                                    <span class="insight-value warning">Medium</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Recommended Action:</span>
                                    <span class="insight-value">Hold with trailing stop</span>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Metrics Card -->
                        <div class="overview-card fixed-height" data-card-id="performance-metrics">
                            <h3>Performance Metrics</h3>
                            <div class="card-controls">
                                <button class="card-expand-btn" title="Expand/Collapse">
                                    <i class="fas fa-expand-alt"></i>
                                </button>
                                <button class="card-more-btn" title="View More">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                            </div>
                            <div class="card-content scrollable">
                                <div class="performance-grid">
                                    <div class="metric">
                                        <span class="value positive">+15.7%</span>
                                        <span class="label">YTD Return</span>
                                    </div>
                                    <div class="metric-chart">
                                        <svg class="line-chart">
                                            <polyline points="0,40 20,35 40,30 60,25 80,20 100,15" 
                                                      fill="none" stroke="var(--primary-text)" stroke-width="2"/>
                                        </svg>
                                    </div>
                                    <div class="metric">
                                        <span class="value">1.82</span>
                                        <span class="label">Sharpe Ratio</span>
                                    </div>
                                    <div class="pie-chart"></div>
                                    <div class="metric">
                                        <span class="value">65%</span>
                                        <span class="label">Win Rate</span>
                                    </div>
                                    <div class="metric-chart">
                                        <svg class="line-chart">
                                            <polyline points="0,30 20,28 40,32 60,29 80,25 100,22" 
                                                      fill="none" stroke="var(--warning-text)" stroke-width="2"/>
                                        </svg>
                                    </div>
                                    <div class="metric">
                                        <span class="value negative">-8.3%</span>
                                        <span class="label">Max Drawdown</span>
                                    </div>
                                    <div class="metric">
                                        <span class="value">2.45</span>
                                        <span class="label">Profit Factor</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Market Intelligence Overview Card -->
                        <div class="overview-card fixed-height" data-card-id="market-intelligence">
                            <h3>Market Intelligence Overview</h3>
                            <div class="card-controls">
                                <button class="card-expand-btn" title="Expand/Collapse">
                                    <i class="fas fa-expand-alt"></i>
                                </button>
                                <button class="card-more-btn" title="View More">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                            </div>
                            <div class="card-content scrollable">
                                <div class="ai-insight">
                                    <span class="insight-label">Market Regime:</span>
                                    <span class="insight-value positive">Bull Market</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Volatility Regime:</span>
                                    <span class="insight-value">Low to Medium</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Cross-Asset Signal:</span>
                                    <span class="insight-value positive">Risk-On Environment</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Alternative Data:</span>
                                    <span class="insight-value">Satellite traffic +3.2%</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Dark Pool Activity:</span>
                                    <span class="insight-value warning">Elevated in Tech</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Options Flow:</span>
                                    <span class="insight-value positive">Bullish Bias</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sauron's Vision Eye Card -->
                        <div class="overview-card fixed-height" data-card-id="sauron-vision">
                            <h3>Sauron's Vision Eye</h3>
                            <div class="card-controls">
                                <button class="card-expand-btn" title="Expand/Collapse">
                                    <i class="fas fa-expand-alt"></i>
                                </button>
                                <button class="card-more-btn" title="View More">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                            </div>
                            <div class="card-content scrollable">
                                <div class="ai-insight">
                                    <span class="insight-label">Pattern Recognition:</span>
                                    <span class="insight-value positive">7 Active Patterns</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Anomaly Detection:</span>
                                    <span class="insight-value">2 Market Anomalies</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Predictive Accuracy:</span>
                                    <span class="insight-value positive">78.5% (7 days)</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Vision Confidence:</span>
                                    <span class="insight-value positive">High (0.82)</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Market Transparency:</span>
                                    <span class="insight-value">Full Spectrum Analysis</span>
                                </div>
                                <div class="ai-insight">
                                    <span class="insight-label">Next Major Event:</span>
                                    <span class="insight-value warning">Fed Meeting (3 days)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Terminal Section -->
                <section id="terminal" class="content-section">
                    {% include 'components/terminal.html' %}
                </section>

                <!-- Other sections would be included here -->
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/dashboard.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Fixed sidebar toggle functionality
document.getElementById('sidebar-toggle').addEventListener('click', function() {
    const sidebar = document.getElementById('sidebar');
    const newsBar = document.getElementById('news-bar');
    const icon = this.querySelector('i');
    
    sidebar.classList.toggle('retracted');
    
    // Update icon rotation
    if (sidebar.classList.contains('retracted')) {
        icon.style.transform = 'rotate(180deg)';
        newsBar.classList.add('visible');
    } else {
        icon.style.transform = 'rotate(0deg)';
        newsBar.classList.remove('visible');
    }
});

// News filter functionality
document.querySelectorAll('.news-filter-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.news-filter-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        const filter = this.dataset.filter;
        document.querySelectorAll('.news-item').forEach(item => {
            if (filter === 'all' || item.dataset.type === filter) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    });
});

// Chart toggle functionality
function toggleChart(button) {
    const container = button.parentElement.querySelector('.mini-chart-container');
    const icon = button.querySelector('i');
    
    button.classList.toggle('locked');
    container.classList.toggle('show');
    
    if (button.classList.contains('locked')) {
        icon.className = 'fas fa-chevron-up';
    } else {
        icon.className = 'fas fa-chevron-down';
    }
}

// Make news items clickable
document.querySelectorAll('.news-item').forEach(item => {
    item.addEventListener('click', function() {
        console.log('Opening article...');
    });
});

// Information bar pause on hover
const infoBarContent = document.querySelector('.info-bar-content');
infoBarContent.addEventListener('mouseenter', function() {
    this.style.animationPlayState = 'paused';
});
infoBarContent.addEventListener('mouseleave', function() {
    this.style.animationPlayState = 'running';
});

// Card expand/collapse functionality
document.querySelectorAll('.card-expand-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const card = this.closest('.overview-card, .signals-overview');
        const icon = this.querySelector('i');
        
        card.classList.toggle('expanded');
        
        if (card.classList.contains('expanded')) {
            icon.className = 'fas fa-compress-alt';
        } else {
            icon.className = 'fas fa-expand-alt';
        }
    });
});

// Bulk actions
document.querySelector('.bulk-action-btn').addEventListener('click', function(e) {
    e.stopPropagation();
    const menu = document.querySelector('.bulk-actions-menu');
    menu.classList.toggle('show');
});

document.addEventListener('click', function() {
    document.querySelector('.bulk-actions-menu').classList.remove('show');
});

document.querySelectorAll('.bulk-action-item').forEach(item => {
    item.addEventListener('click', function(e) {
        e.stopPropagation();
        const action = this.dataset.action;
        
        switch(action) {
            case 'expand-all':
                document.querySelectorAll('.overview-card, .signals-overview').forEach(card => {
                    card.classList.add('expanded');
                    card.querySelector('.card-expand-btn i').className = 'fas fa-compress-alt';
                });
                break;
            case 'collapse-all':
                document.querySelectorAll('.overview-card, .signals-overview').forEach(card => {
                    card.classList.remove('expanded');
                    card.querySelector('.card-expand-btn i').className = 'fas fa-expand-alt';
                });
                break;
            // Add more actions as needed
        }
        
        document.querySelector('.bulk-actions-menu').classList.remove('show');
    });
});

// Portfolio tabs
document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const tab = this.dataset.tab;
        
        // Update button states
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        // Update content
        document.querySelectorAll('.tab-content').forEach(content => {
            content.style.display = 'none';
        });
        document.getElementById(`${tab}-tab`).style.display = 'block';
    });
});

// Notification badges animation
function updateNotificationBadges() {
    document.querySelectorAll('.notification-icon, .activity-icon, .alert-icon').forEach(icon => {
        const count = parseInt(icon.dataset.count);
        const badge = icon.querySelector('.notification-count, .activity-count, .alert-count');
        
        if (count > 0) {
            icon.classList.add('has-notifications');
            badge.style.display = 'flex';
        } else {
            icon.classList.remove('has-notifications');
            badge.style.display = 'none';
        }
    });
}

updateNotificationBadges();
</script>
{% endblock %}